$(function(){var c=window.location.protocol+"//"+window.location.hostname;$("#projects-list a.update").live("click",editProject);$("#projects-grid a.update").live("click",editProject);$("#createProjectBtn, a#settings-tab").live("click",editProject);$("body").append('<div id="manageProjectDlg"></div>');var b=$("#manageProjectDlg").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,width:850,height:450,beforeClose:function(d,e){b.html("")}});$(".manageProject").live("click",a);function a(){$.getJSON(this.href,{action:"gantt",YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(f){var e='<div id="overalProjectProgress"></div>					<div id="projectGanttDiagram" style="width:90%; height:400px; margin:0 auto;"></div>';b.html(e);var d=0;if(f.tasksCounts.total!=0){d=Math.round(f.tasksCounts.completed/(f.tasksCounts.total/100))}b.find("#overalProjectProgress").fprogressBar({progress:d});var g={source:f.source,navigate:"scroll",scale:"days",minScale:"days",maxScale:"months",holydays:[]};b.find("#projectGanttDiagram").append('<div class="gantt"></div>').find(".gantt:first").gantt(g);b.dialog("option","title",f.project.name);b.dialog("open")}).error(function(d,f,e){});return false}});function nearTrim(b,c,a){if(a===undefined){a="\u2026"}if(c>=b.length){return b}return b.substr(0,c).replace(/\s+?(\S+)?$/,"").replace(/\s+$/,"")+a}function submitProjectForm(){$("#project-form").ajaxSubmit({success:function(a){$("#project-form-dialog").html(a.html);$("#project-form .chzn-select").chosen();if(a.success){if($("#projects-list").length!=0){$("#projects-list").yiiListView.update("projects-list")}if($("#projects-grid").length!=0){$("#projects-grid").yiiGridView.update("projects-grid")}$("#project-form-dialog").dialog("close");if($("#project-item-"+a.projectID).length!=0){$("#project-item-"+a.projectID).html('<li><a href="#" onclick="return switchToProject('+a.projectID+');" class="project-url">'+nearTrim(a.projectName,17)+"</a></li>")}else{$(".projects-container").prepend('<li class="project-item-'+a.projectID+'"><a href="#" onclick="return switchToProject('+a.projectID+');" class="project-url">'+nearTrim(a.projectName,17)+"</a></li>")}if($("#view-project-link-"+a.projectID).length!=0){$("#view-project-link-"+a.projectID).text(nearTrim(a.projectName,20))}if($("div.steps").length!=0){window.location="/project/choose/?menu_project_id="+a.projectID+"&rr=new%2F2%3Fcompleted_step_1=1"}}},dataType:"json"});return false}function closeDialog(){$(this).dialog("close");return false}function editProject(targetObj){var windowWidth=$(window).width(),width=565,xoffset=eval((windowWidth/2)-(width/2));$.get(this.href,{YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(data){if(data.success){dlg=$("#project-form-dialog").html(data.html);$("#project-form").css("display","block");if(targetObj.currentTarget.attributes["class"].nodeValue=="update"){dlg.dialog({modal:true,dialogClass:"infobox",width:width,position:[xoffset,100],title:"Edit Project"})}else{dlg.dialog({modal:true,dialogClass:"infobox",width:width,position:[xoffset,100],title:"New Project"});$("#archived-row").hide()}$("#project-form .chzn-select",dlg).width(eval(width*0.9));$("#project-form .chzn-select",dlg).chosen();dlg.dialog("open")}else{if(!data.success&&data.limit=="1"){dlg=$("#update-dialog").html(data.html);dlg.dialog("open")}}$(".ui-dialog-buttonset").attr("style","clear:both;")},"json").error(function(jqXHR,textStatus,errorThrown){});return false};
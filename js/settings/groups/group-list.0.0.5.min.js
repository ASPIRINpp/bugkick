(function(a){a.fn.liveDraggable=function(b){this.live("mousemove",function(){a(this).draggable(b)})}})(jQuery);var groupsAfterAjaxUpdate;$(function(){function n(c,e,f){$.post("",{YII_CSRF_TOKEN:YII_CSRF_TOKEN,action:"getGroupMembers",group_id:c},function(g){$("div.userItem").show();var h="";$.each(g,function(b,c){h+='\n\t\t\t\t\t<div class="user round3">\n\t\t\t\t\t\t<div class="userImage round6"><img class="round6" alt="" src="'+c.profile_img+'" /></div>\n\t\t\t\t\t\t<div class="userName"><a href="'+a+"/user/view/"+c.user_id+'" target="_blank">'+c.name+" "+c.lname+'</a></div>\n\t\t\t\t\t\t<span class="invis user_id">'+c.user_id+"</span>\n\t\t\t\t\t</div>";$("#userItem_"+c.user_id).hide()});b.hide();d.find(".usersContainer").html(h);d.find(".groupCaption").html(e).css("background-color",f);l(d);d.data("group_id",c).show()})}function m(){$("#usersCount_"+d.data("group_id")).text(d.find("div.user").length);d.data("group_id",null).hide();b.show();$("div.userItem").show()}function l(a){a.find(".userImage img").each(function(){var a=$(this);var b=a.width()>a.height()?"width":"height";a.css(b,31)})}function k(){if(!confirm("Are you sure?"))return false;var a=$(this);var b=a.parent("div.userGroupItem").find("span.group_id:first").text();$.post("",{YII_CSRF_TOKEN:YII_CSRF_TOKEN,action:"deleteGroup",group_id:b},function(a){$("#group-list").yiiListView.update("group-list")}).error(function(a){});return true}function j(){var a=$(this);var b=a.parent("div.nameContainer").parent("div.userGroupItem");var c=b.find("span.group_id:first").text(),d=a.find("span.groupName:first").text();n(c,d,b.css("background-color"))}function i(a,b){g(a,b,"removeFromGroup",function(a){})}function h(a,b,c){g(a,b,"addToGroup",function(a){if(c!==undefined)c(a)})}function g(a,b,c,d){$.post("",{YII_CSRF_TOKEN:YII_CSRF_TOKEN,action:c,group_id:a,user_id:b},d).error(function(){})}function f(){$(".userGroupItem:not(.ui-droppable)").droppable({accept:".userItem",activeClass:"droppableActive",over:function(a,b){$(this).addClass("groupOver")},out:function(a,b){$(this).removeClass("groupOver")},drop:function(a,b){var c=$(this);var d=b.draggable.find("span.user_id:first").text(),f=c.find("span.group_id:first").text();h(f,d,function(a){if(a.success){var b=$("#usersCount_"+f),d=parseInt(b.text(),10);b.text(d+1);var g=c.offset();var h=g.left-e.width()/2,i=g.top-e.height()/2;e.css({left:h,top:i}).show().animate({left:h-e.width(),top:i-e.height()},"slow","linear",function(){e.hide()})}});$(this).removeClass("groupOver")}})}var a=window.location.protocol+"//"+window.location.hostname,b=$("#groups"),c=$("#users"),d=$("#group");groupsAfterAjaxUpdate=function(a,b){f()};$("body").prepend('<div id="plusOneSphere" class="invis plusOneSphere"></div>');var e=$("#plusOneSphere");f();$(".userGroupItem .name").live("click",j);$("#group .gBack").live("click",m);$(".userGroupItem .delete").live("click",k);l(c);$(".userItem:not(.ui-draggable), .user:not(.ui-draggable)").liveDraggable({zIndex:999,helper:"clone",cursor:"pointer",opacity:.618});$(".usersContainer").droppable({accept:".userItem",activeClass:"droppableActive",drop:function(a,b){var c=b.draggable.find("span.user_id:first").text();b.draggable.hide().clone().removeAttr("style").removeAttr("id").attr("class","user round3").appendTo(this).show();h(d.data("group_id"),c)}});$("#user-list .items").droppable({accept:".user",activeClass:"droppableActive",drop:function(a,b){var c=b.draggable.find("span.user_id:first").text();b.draggable.remove();$("#userItem_"+c,this).show();i(d.data("group_id"),c)}})})